<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>glass and small vase- Nook Decor</title>

<link href="https://fonts.googleapis.com/css2?family=Didot&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

<style>
:root{
  --beige:#DFC9AB;
  --burgundy:#4b0e1f;
  --line:rgba(75,14,31,.18);
}

body{
  margin:0;
  font-family:'Poppins',sans-serif;
  background:var(--beige);
  color:var(--burgundy);
}

header{
  background:var(--beige);
  padding:15px;
  text-align:center;
  font-size:28px;
  font-family:'Didot',serif;
  position:relative;
  color:var(--burgundy);
  border-bottom:1px solid var(--line);
}

#langSelect{
  position:absolute;
  right:20px;
  top:50%;
  transform:translateY(-50%);
  padding:6px 10px;
  border:none;
  border-radius:8px;
  font-weight:bold;
  background:var(--burgundy);
  color:var(--beige);
  cursor:pointer;
}

/* ================= CARD ================= */
.product-card{
  width:fit-content;
  margin:30px auto;
  background:transparent;
  border-radius:0;
  padding:0;
}

.product-container{
  display:flex;
  gap:25px;
  align-items:center;
  flex-wrap:wrap;
  justify-content:center;
}

/* ================= SLIDER ================= */
.slider{
  position:relative;
  width:100%;
  max-width:420px;
  display:flex;
  justify-content:center;
}

.slide{
  width:100%;
  border-radius:15px;
  display:none;
  margin:0 auto;
  image-rendering:auto;
}

.slide.active{display:block}

.slider .slide{
  object-fit:contain;
  transform:translateZ(0);
  backface-visibility:hidden;
  -webkit-font-smoothing:antialiased;
}

.arrow{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  background:none;
  border:none;
  font-size:36px;
  color:var(--burgundy);
  cursor:pointer;
  user-select:none;
}

.arrow.right{right:10px}

/* ================= DETAILS ================= */
.product-details{
  max-width:380px;
}

.product-details h1{
  font-family:'Didot',serif;
  color:var(--burgundy);
  margin:0 0 10px;
}

.product-details p{
  margin:0;
  color:rgba(75,14,31,.85);
}

.price{
  font-size:22px;
  margin:15px 0;
  color:var(--burgundy);
}

.btn{
  background:var(--burgundy);
  border:none;
  padding:12px 24px;
  border-radius:10px;
  font-weight:bold;
  cursor:pointer;
  color:var(--beige);
  width:100%;
}

.back-link{
  display:block;
  text-align:center;
  margin:40px;
  color:var(--burgundy);
  text-decoration:none;
}

/* ================= MOBILE ================= */
@media(max-width:768px){
  .product-container{
    flex-direction:column;
    gap:18px;
    align-items:center;
  }

  .slider{
    max-width:95%;
  }

  .slide{
    max-height:480px;
    object-fit:contain;
  }

  .arrow{
    font-size:44px;
  }

  .product-details{
    max-width:95%;
    text-align:center;
  }
}

@media(max-width:420px){
  .slider{ max-width:92%; }
}
</style>
</head>

<body>

<header>
  <span id="pageTitle">Decor Pieces</span>
  <select id="langSelect">
    <option value="en">English</option>
    <option value="ar">العربية</option>
  </select>
</header>

<div id="productsContainer"></div>

<a href="index.html" class="back-link" id="backLink">← Back to Home</a>

<script>
/* =================== CART (UNIFIED + MIGRATION) =================== */
const CART_KEY = "nook_cart";
const OLD_CART_KEY = "cart";
const MIGRATION_FLAG = "nook_cart_migrated_v1";
const FALLBACK_IMG = "https://i.postimg.cc/3RVR3GnB/ac037baf-0cb0-4349-9f9d-c1dbc61a6ddd.png";

function safeParse(v){
  try { return JSON.parse(v); } catch(e){ return null; }
}

function getCart(){
  const data = safeParse(localStorage.getItem(CART_KEY));
  return Array.isArray(data) ? data : [];
}

function saveCart(cart){
  localStorage.setItem(CART_KEY, JSON.stringify(cart));
  localStorage.setItem("cartItems", JSON.stringify(cart)); // compatibility
}

function readCartRaw(key){
  const data = safeParse(localStorage.getItem(key));
  return Array.isArray(data) ? data : [];
}

function normalizeItem(it){
  const id = it && it.id ? String(it.id) : "";
  const name = it && it.name ? String(it.name) : "Item";
  const price = Number(it && it.price) || 0;
  const qty = Math.max(1, Number(it && it.qty) || 1);
  const img = it && it.img ? String(it.img) : FALLBACK_IMG;

  return {
    id: id || ("legacy_" + name.toLowerCase().replace(/\s+/g,"_") + "_" + price),
    name,
    price,
    qty,
    img,
    category: it && it.category ? String(it.category) : "General",
    page: it && it.page ? String(it.page) : "",
    addedAt: it && it.addedAt ? String(it.addedAt) : new Date().toISOString()
  };
}

function mergeDedup(arrA, arrB){
  const map = new Map();
  [...arrA, ...arrB].forEach(raw=>{
    const item = normalizeItem(raw);
    const key = item.id;
    if(!map.has(key)){
      map.set(key, {...item});
    }else{
      const existing = map.get(key);
      existing.qty = (Number(existing.qty)||1) + (Number(item.qty)||1);
      if((existing.img === FALLBACK_IMG) && item.img && item.img !== FALLBACK_IMG){
        existing.img = item.img;
      }
      map.set(key, existing);
    }
  });
  return Array.from(map.values());
}

function migrateOldCartOnce(){
  const already = localStorage.getItem(MIGRATION_FLAG) === "1";
  if(already) return;

  const newCart = readCartRaw(CART_KEY);
  const oldCart = readCartRaw(OLD_CART_KEY);

  if(oldCart.length){
    const merged = mergeDedup(newCart, oldCart);
    saveCart(merged);
    localStorage.removeItem(OLD_CART_KEY); // stop duplication forever
  }

  localStorage.setItem(MIGRATION_FLAG, "1");
}

/* ================= DATA ================= */
const products = [
  ["https://i.postimg.cc/fRxYWV2Y/l-a-m.jpg","https://i.postimg.cc/Bbr1432g/l-a.jpg"],
  ["https://i.postimg.cc/CKcBdkjZ/l-b-m.png","https://i.postimg.cc/BtftRgGT/l-b.jpg"],
  ["https://i.postimg.cc/13cvtmJy/l-h-m.png","https://i.postimg.cc/50jgnw1y/l-h.jpg"],
  ["https://i.postimg.cc/FzLZQNY7/l-s-m.jpg","https://i.postimg.cc/BZrpBLzp/l-s.jpg"],
  ["https://i.postimg.cc/9XJXGCSX/s-m.jpg","https://i.postimg.cc/QxzXySjB/s.jpg"],
  ["https://i.postimg.cc/WpWjdSFt/th-m.jpg","https://i.postimg.cc/FRF5RJ99/th.png"],
  ["https://i.postimg.cc/s2yb6ZGy/ʿ-a-m.png","https://i.postimg.cc/xTz79PKY/ʿ-a.jpg"],
  ["https://i.postimg.cc/LX5Cwk94/ʿ-s-m.jpg","https://i.postimg.cc/NG3t8FDR/ʿ-s.jpg"],
  ["https://i.postimg.cc/Vk42hkqr/f-la-m.png","https://i.postimg.cc/T1r4Jd25/f-la.jpg"],
  ["https://i.postimg.cc/KYwpXkRG/f-la-a-m.jpg","https://i.postimg.cc/L5BxZxvk/f-la.png"],
  ["https://i.postimg.cc/XvSxQMhB/b-m.png","https://i.postimg.cc/gjTHh18G/b.jpg"],
  ["https://i.postimg.cc/W43w12QH/t-a-m.png","https://i.postimg.cc/gkWy6yCV/t-abyd.png"],
  ["https://i.postimg.cc/pL0K7wph/t-b-m.png","https://i.postimg.cc/9fKZXyPD/t-b.png"],
  ["https://i.postimg.cc/BQpFLrc0/t-h-m.jpg","https://i.postimg.cc/PJ4CDDDr/t-h.jpg"],
  ["https://i.postimg.cc/3NKR3wqT/t-s-m.png","https://i.postimg.cc/t41gqwBg/t-s.jpg"],
  ["https://i.postimg.cc/fL37xDjj/y-m.png","https://i.postimg.cc/2S2nMV0d/y.jpg"]
];

const names = [
  {en:"Classic White Glass Vase", ar:"مزهرية زجاج كلاسيك أبيض"},
  {en:"Classic Fuchsia Pink Glass Vase", ar:"مزهرية زجاج كلاسيك فوشيا"},
  {en:"Classic Red Glass Vase", ar:"مزهرية زجاج كلاسيك أحمر"},
  {en:"Classic Yellow Glass Vase", ar:"مزهرية زجاج كلاسيك أصفر"},
  {en:"Glass Vase", ar:"مزهرية زجاج"},
  {en:"Sun Flower Glass Vase", ar:"مزهرية زجاج دوّار الشمس"},
  {en:"White Sun Flower Glass Vase", ar:"مزهرية دوّار الشمس أبيض"},
  {en:"Yellow Sun Flower Glass Vase", ar:"مزهرية دوّار الشمس أصفر"},
  {en:"Purple Glass Vase", ar:"مزهرية زجاج بنفسجي"},
  {en:"White Glass Vase", ar:"مزهرية زجاج أبيض"},
  {en:"Purple Glass Vase", ar:"مزهرية زجاج بنفسجي"},
  {en:"Modern White Glass Vase", ar:"مزهرية زجاج مودرن أبيض"},
  {en:"Modern Pink Glass Vase", ar:"مزهرية زجاج مودرن وردي"},
  {en:"Modern Red Glass Vase", ar:"مزهرية زجاج مودرن أحمر"},
  {en:"Modern Yellow Glass Vase", ar:"مزهرية زجاج مودرن أصفر"},
  {en:"Baby Pink Glass Vase", ar:"مزهرية زجاج وردي فاتح"}
];

const descs = [
  {en:"Timeless clear design that complements any table or shelf.", ar:"تصميم كلاسيكي أنيق يناسب أي ترابيزة أو رف."},
  {en:"Bold fuchsia tone for a vibrant, stylish accent.", ar:"لون فوشيا جريء يدي لمسة ستايل مميزة."},
  {en:"Classic red glass that adds warmth and character.", ar:"زجاج أحمر كلاسيكي يضيف دفء وشخصية للمكان."},
  {en:"Sunny yellow finish to brighten your décor instantly.", ar:"أصفر مشرق ينوّر الديكور فورًا."},
  {en:"A clean everyday glass vase—simple and elegant.", ar:"مزهرية زجاج بسيطة وأنيقة للاستخدام اليومي."},
  {en:"Sunflower-inspired piece for a cheerful decorative touch.", ar:"مستوحاة من دوّار الشمس… لمسة بهجة للديكور."},
  {en:"White sunflower vibe with a soft, airy look.", ar:"دوّار الشمس بالأبيض… شكل هادي وخفيف."},
  {en:"Yellow sunflower feel—perfect for lively corners.", ar:"دوّار الشمس بالأصفر… مثالي للزوايا الحيوية."},
  {en:"Deep purple glass for a luxe statement look.", ar:"زجاج بنفسجي عميق لإحساس فخم ولافت."},
  {en:"Minimal white glass that fits modern spaces perfectly.", ar:"زجاج أبيض مينيمال يناسب المودرن جدًا."},
  {en:"Purple glass with a sleek silhouette for elegant styling.", ar:"زجاج بنفسجي بسيلويت أنيق لستايل راقي."},
  {en:"Modern white vase with a clean contemporary shape.", ar:"مزهرية مودرن أبيض بشكل معاصر ونضيف."},
  {en:"Modern pink tone that adds a soft feminine touch.", ar:"وردي مودرن يضيف لمسة ناعمة وأنثوية."},
  {en:"Modern red glass with a bold, artistic presence.", ar:"أحمر مودرن بحضور قوي وفني."},
  {en:"Modern yellow glass to refresh your décor with color.", ar:"أصفر مودرن ينعش الديكور بلون حلو."},
  {en:"Baby pink glass for a calm, cute aesthetic.", ar:"وردي فاتح لإحساس هادي وكيوت."}
];

/* ================= ADD TO CART (BY ID) ================= */
function addToCart(btn, product, lang){
  let cart = getCart();
  const existing = cart.find(p => p.id === product.id);

  if(existing){
    existing.qty = (Number(existing.qty) || 1) + 1;
    existing.name = product.name; // update display name based on current lang
  }else{
    cart.push({
      id: product.id,
      name: product.name,
      price: Number(product.price) || 0,
      img: product.img || FALLBACK_IMG,
      qty: 1,
      category: "Glass Vases",
      page: location.pathname,
      addedAt: new Date().toISOString()
    });
  }

  saveCart(cart);

  btn.innerText = lang==="ar"?"تم الإضافة!":"Added!";
  btn.style.background="#fff";
  btn.style.color="#4b0e1f";

  setTimeout(()=>{
    btn.innerText = lang==="ar"?"أضف إلى السلة":"Add to Cart";
    btn.style.background="var(--burgundy)";
    btn.style.color="var(--beige)";
  },1200);
}

/* ================= RENDER ================= */
const container = document.getElementById("productsContainer");

function renderProducts(lang){
  container.innerHTML="";

  products.forEach((imgs,i)=>{
    const card=document.createElement("div");
    card.className="product-card";

    const title = names[i] ? names[i][lang] : (lang==="ar" ? "مزهرية زجاج" : "Glass Vase");
    const desc  = descs[i] ? descs[i][lang] : (lang==="ar" ? "قطعة ديكور أنيقة تضيف لمسة مميزة." : "Elegant decor piece that adds a refined touch.");

    const productId = `glass_vase_${i+1}`;

    card.innerHTML=`
      <div class="product-container">
        <div class="slider">
          <img src="${imgs[0]}" class="slide active" alt="" onerror="this.src='${FALLBACK_IMG}'">
          <img src="${imgs[1]}" class="slide" alt="" onerror="this.src='${FALLBACK_IMG}'">
          <button class="arrow right" aria-label="next">›</button>
        </div>

        <div class="product-details">
          <h1>${title}</h1>
          <p>${desc}</p>
          <div class="price">500 EGP</div>
          <button class="btn add-to-cart">${lang==="ar"?"أضف إلى السلة":"Add to Cart"}</button>
        </div>
      </div>
    `;

    const btn=card.querySelector(".add-to-cart");
    btn.onclick=()=>addToCart(btn,{
      id: productId,
      name: title,
      price: 500,
      img: imgs[0]
    },lang);

    container.appendChild(card);
  });

  initSliders();
}

/* ================= SLIDER (7s) ================= */
function initSliders(){
  document.querySelectorAll(".slider").forEach(slider=>{
    const slides=slider.querySelectorAll(".slide");
    const next=slider.querySelector(".arrow.right");
    let i=0;

    const show=()=>{
      slides.forEach(s=>s.classList.remove("active"));
      slides[i].classList.add("active");
    };

    next.onclick=()=>{
      i=(i+1)%slides.length;
      show();
    };

    setInterval(()=>{
      i=(i+1)%slides.length;
      show();
    },7000);
  });
}

/* ================= LANGUAGE ================= */
const langSelect = document.getElementById("langSelect");
const backLink = document.getElementById("backLink");

let currentLang = localStorage.getItem("siteLang") || "en";
langSelect.value = currentLang;

langSelect.addEventListener("change",()=>{
  currentLang = langSelect.value;
  localStorage.setItem("siteLang", currentLang);

  document.body.dir=currentLang==="ar"?"rtl":"ltr";
  backLink.textContent=currentLang==="ar"?"← العودة للرئيسية":"← Back to Home";
  renderProducts(currentLang);
});

/* ✅ run once + initial render */
migrateOldCartOnce();
document.body.dir=currentLang==="ar"?"rtl":"ltr";
backLink.textContent=currentLang==="ar"?"← العودة للرئيسية":"← Back to Home";
renderProducts(currentLang);
</script>

</body>
</html>
