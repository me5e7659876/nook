<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Checkout - Nook Decor</title>

<link href="https://fonts.googleapis.com/css2?family=Didot&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

<style>
:root{
  --beige:#DFC9AB;
  --burgundy:#4b0e1f;
  --line:rgba(75,14,31,.18);
}

body {
  font-family: 'Poppins', sans-serif;
  margin: 0;
  background-color: var(--beige);
  color: var(--burgundy);
}

/* HEADER */
header {
  background-color: var(--beige);
  padding: 15px 10px;
  text-align: center;
  box-shadow: 0 8px 20px rgba(0,0,0,0.18);
  position: relative;
  border-bottom: 1px solid var(--line);
}
header img.logo { width: 140px; max-width: 80%; }
.header-icons {
  position: absolute;
  top: 15px;
  right: 10px;
  display: flex;
  gap: 12px;
}
.header-icons a { color: var(--burgundy); text-decoration: none; font-size: 24px; }

/* PROGRESS STEPS */
.steps-container {
  margin: 15px auto;
  width: 95%;
  display: flex;
  justify-content: space-between;
  position: relative;
}
.steps-container::before {
  content: "";
  position: absolute;
  top: 17px;
  left: 0;
  width: 100%;
  height: 2px;
  background: var(--line);
  z-index: 1;
}
.step { text-align: center; z-index: 2; }
.step .circle {
  width: 30px;
  height: 30px;
  background: var(--burgundy);
  color: var(--beige);
  margin: auto;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  font-weight: 700;
  font-size: 14px;
  box-shadow: 0 0 6px rgba(75,14,31,0.35);
}
.step.active .circle { background: var(--burgundy); color: var(--beige); }
.step.completed .circle { background: var(--burgundy); color: var(--beige); }
.step p { margin-top: 4px; font-size: 12px; color: var(--burgundy); }

/* CONTAINER */
.checkout-container {
  display: flex;
  gap: 10px;
  padding: 10px;
  justify-content: center;
  flex-wrap: wrap;
  max-width: 100%;
  margin: auto;
}

/* ORDER SUMMARY */
.order-summary {
  background: rgba(223,201,171,0.92);
  padding: 10px;
  border-radius: 10px;
  width: 100%;
  max-width: 360px;
  border: 1px solid var(--line);
}
.order-summary h2 { margin-top: 0; color: var(--burgundy); font-size: 16px; }
.order-item {
  display: flex;
  justify-content: space-between;
  margin: 6px 0;
  align-items: center;
  font-size: 13px;
  color: var(--burgundy);
}
.order-item img {
  width: 40px;
  height: 40px;
  object-fit: cover;
  border-radius: 6px;
  margin-right: 8px;
}
.total {
  font-weight: 700;
  margin-top: 10px;
  font-size: 14px;
  border-top: 1px solid var(--line);
  padding-top: 6px;
  color: var(--burgundy);
}

/* FORM */
.checkout-form {
  background: rgba(223,201,171,0.92);
  padding: 10px;
  border-radius: 10px;
  width: 100%;
  max-width: 360px;
  border: 1px solid var(--line);
}
.checkout-form h2 { color: var(--burgundy); margin-top: 0; font-size: 16px; }
.checkout-form label { display: block; margin-top: 8px; font-size: 12px; color: var(--burgundy); }

.checkout-form input, 
.checkout-form select {
  width: 100%;
  padding: 6px;
  margin-top: 3px;
  border-radius: 4px;
  border: 1px solid var(--line);
  background: rgba(255,255,255,0.45);
  color: var(--burgundy);
  font-size: 12px;
}
.checkout-form input:focus, .checkout-form select:focus { outline: 2px solid var(--burgundy); }

/* PAYMENT METHODS INLINE */
.payment-methods label {
  display: flex;
  align-items: center;
  gap: 4px;
  margin-top: 8px;
  padding: 5px 6px;
  background: rgba(75,14,31,0.06);
  border: 1px solid var(--line);
  border-radius: 6px;
  cursor: pointer;
  flex-wrap: wrap;
  font-size: 12px;
  color: var(--burgundy);
}
.payment-methods input[type="radio"] { margin: 0; }
.payment-methods img { width: 25px; height: 25px; object-fit: contain; vertical-align: middle; }

/* PAYMENT FIELDS INLINE */
.payment-fields-inline {
  display: flex;
  gap: 3px;
  margin-left: 4px;
  flex-wrap: wrap;
  margin-top: 3px;
}
.payment-fields-inline input {
  padding: 3px;
  font-size: 11px;
  background: rgba(255,255,255,0.45);
  border: 1px solid var(--line);
  border-radius: 3px;
  color: var(--burgundy);
  width: 100%;
  flex: 1 1 50px;
}

/* SUBMIT BUTTON */
.confirm-btn {
  width: 100%;
  padding: 10px;
  margin-top: 15px;
  background: var(--burgundy);
  border: none;
  border-radius: 8px;
  font-size: 14px;
  color: var(--beige);
  font-weight: 700;
  cursor: pointer;
  transition: 0.25s;
}
.confirm-btn:hover { opacity: 0.92; }

/* FOOTER */
footer {
  text-align: center;
  padding: 10px;
  background-color: var(--beige);
  margin-top: 15px;
  color: var(--burgundy);
  border-top: 1px solid var(--line);
}

/* RESPONSIVE MOBILE */
@media (max-width: 768px){
  body { padding: 0; margin:0; }
  .checkout-container { flex-direction: column; gap: 8px; padding: 5px; width: 100%; margin: 0; }
  .order-summary, .checkout-form { width: 100%; max-width: 100%; padding: 8px; }
  .steps-container { flex-direction: row; gap: 5px; width: 95%; margin: auto; }
  .steps-container::before { top: 16px; height: 2px; }
  .payment-fields-inline { flex-direction: row; margin-left:0; gap:2px; }
  .checkout-form input, .checkout-form select { font-size: 11px; padding: 4px; }
  .confirm-btn { font-size: 14px; padding: 8px; }
}
</style>
</head>

<body>

<header>
  <img src="https://i.postimg.cc/VLdBwSc7/Chat-GPT-Image-Nov-27-2025-03-59-19-AM.png" alt="Logo" class="logo">
  <div class="header-icons">
    <a href="cart.html">ðŸ›’</a>
    <a href="login.html">ðŸ‘¤</a>
  </div>
</header>

<div class="steps-container">
  <div class="step completed"><div class="circle">1</div><p>Cart</p></div>
  <div class="step active"><div class="circle">2</div><p>Shipping</p></div>
  <div class="step"><div class="circle">3</div><p>Payment</p></div>
  <div class="step"><div class="circle">4</div><p>Review</p></div>
</div>

<div class="checkout-container">

  <!-- ORDER SUMMARY -->
  <div class="order-summary">
    <h2>Order Summary</h2>
    <div id="orderItems"></div>
    <div class="order-item" style="margin-top:8px;"><span>Shipping</span><span id="shippingFee">FREE</span></div>
    <div class="order-item"><span>Discount</span><span id="discountFee">0 EGP</span></div>
    <div class="total" id="totalAmount">Total: 0 EGP</div>
  </div>

  <!-- SHIPPING + PAYMENT FORM -->
  <form class="checkout-form" id="checkoutForm">
    <h2>Shipping Information</h2>
    <label for="fullName">Full Name</label>
    <input type="text" id="fullName" placeholder="Your name" required>
    <label for="address">Address</label>
    <input type="text" id="address" placeholder="Street, City, Country" required>
    <label for="phone">Phone Number</label>
    <input type="tel" id="phone" placeholder="010XXXXXXXX" required>

    <h2>Payment Method</h2>
    <div class="payment-methods">
      <label>
        <input type="radio" name="payment" value="credit" required>
        <img src="https://i.postimg.cc/5yVLRWp5/shrwt-Ê¿ml-fyza-kard-bnk-msr-wma-hy-afdl-btaqt-aytmanyt-fy-msr.jpg" alt="Credit Card"> Credit/Debit Card
        <div class="payment-fields-inline" id="creditFields">
          <input type="text" placeholder="Card Number" id="cardNumber" maxlength="16">
          <input type="text" placeholder="MM/YY" id="expiry" maxlength="5">
          <input type="text" placeholder="CVC" id="cvc" maxlength="4">
        </div>
      </label>
      <label>
        <input type="radio" name="payment" value="instapay">
        <img src="https://i.postimg.cc/nhZSQ6JR/anstabay-Instapay-lthwyl-alamwal-anthy-mshwar-albnk-mÊ¿-ansta-bay-aljwalat.jpg" alt="Instapay"> Instapay
        <div class="payment-fields-inline" id="instapayFields">
          <input type="text" placeholder="Account / Phone" id="instaAccount">
        </div>
      </label>
      <label>
        <input type="radio" name="payment" value="cod"> Cash on Delivery
      </label>
    </div>

    <button type="submit" class="confirm-btn">Confirm & Pay</button>
  </form>

</div>

<footer>Â© 2025 Nook Decor. All rights reserved.</footer>

<script>
/* âœ… NEW CART KEY */
const CART_KEY = "nook_cart";

function safeParse(v){
  try { return JSON.parse(v); } catch(e){ return null; }
}

function getCart(){
  const data = safeParse(localStorage.getItem(CART_KEY));
  return Array.isArray(data) ? data : [];
}

function saveCart(cart){
  localStorage.setItem(CART_KEY, JSON.stringify(cart));
  localStorage.setItem("cartItems", JSON.stringify(cart)); // compatibility
}

function renderCheckout() {
  const cart = getCart();  /* âœ… ÙƒØ§Ù† localStorage.getItem('cart') */
  const orderContainer = document.getElementById('orderItems');
  const totalEl = document.getElementById('totalAmount');
  const shippingEl = document.getElementById('shippingFee');
  const discountEl = document.getElementById('discountFee');

  orderContainer.innerHTML = '';
  let total = 0;
  const shipping = 0;
  const discount = 0;

  if(cart.length === 0){
    orderContainer.innerHTML = '<p style="text-align:center;">Your cart is empty.</p>';
    totalEl.textContent = 'Total: 0 EGP';
    return;
  }

  cart.forEach(item => {
    const priceNum = parseFloat(String(item.price).replace(/[^0-9.]/g, '')) || 0;
    const qtyNum = Math.max(1, parseInt(item.qty) || 1);
    const itemTotal = priceNum * qtyNum;
    total += itemTotal;

    const safeName = String(item.name || "").replace(/</g, "&lt;").replace(/>/g, "&gt;");

    orderContainer.innerHTML += `
      <div class="order-item">
        <span><img src="${item.img}" alt="${safeName}"> ${safeName} x ${qtyNum}</span>
        <span>${itemTotal.toFixed(2)} EGP</span>
      </div>
    `;
  });

  const finalTotal = total + shipping - discount;
  shippingEl.textContent = shipping === 0 ? 'FREE' : shipping.toFixed(2) + ' EGP';
  discountEl.textContent = discount.toFixed(2) + ' EGP';
  totalEl.textContent = 'Total: ' + finalTotal.toFixed(2) + ' EGP';
}

// Show/hide inline payment fields
const paymentRadios = document.querySelectorAll('input[name="payment"]');
paymentRadios.forEach(radio => {
  radio.addEventListener('change', () => {
    document.getElementById('creditFields').style.display = radio.value === 'credit' ? 'flex' : 'none';
    document.getElementById('instapayFields').style.display = radio.value === 'instapay' ? 'flex' : 'none';
  });
});

// Validate payment fields
function validatePayment(payment) {
  if(payment === 'credit') {
    const card = document.getElementById('cardNumber').value.trim();
    const expiry = document.getElementById('expiry').value.trim();
    const cvc = document.getElementById('cvc').value.trim();
    const cardRegex = /^\d{16}$/;
    const expiryRegex = /^(0[1-9]|1[0-2])\/\d{2}$/;
    const cvcRegex = /^\d{3,4}$/;
    if(!cardRegex.test(card)) { alert('Invalid card number'); return false; }
    if(!expiryRegex.test(expiry)) { alert('Invalid expiry date'); return false; }
    if(!cvcRegex.test(cvc)) { alert('Invalid CVC'); return false; }
  } 
  if(payment === 'instapay') {
    const account = document.getElementById('instaAccount').value.trim();
    if(account.length < 5) { alert('Please enter a valid Instapay account'); return false; }
  }
  return true;
}

// Submit form handler
document.getElementById('checkoutForm').addEventListener('submit', function(e){
  e.preventDefault();
  const fullName = document.getElementById('fullName').value;
  const address = document.getElementById('address').value;
  const phone = document.getElementById('phone').value;
  const payment = document.querySelector('input[name="payment"]:checked')?.value;

  if(!fullName || !address || !phone || !payment){
    alert("Please fill all required fields!");
    return;
  }

  if(!validatePayment(payment)) return;

  alert(`Thank you, ${fullName}! Your order has been placed.\nPayment Method: ${payment}`);

  /* âœ… clear NEW cart */
  localStorage.removeItem(CART_KEY);
  localStorage.removeItem("cartItems");

  window.location.href = 'index.html';
});

renderCheckout();
</script>

</body>
</html>
